#  汇编课程笔记

## 编写汇编源程序

### 可执行文件

汇编语言源程序  写出后，经过编译器，就可以变成可执行文件如.exe

***可执行文件 = 程序 + 数据 + 相关描述信息***

![](pic\83.png)

执行 可执行文件的程序：

1. **汇编源程序经过编译器编译为机器码**
2. **将可执行文件的机器码和数据加载入内存**
3. **进行初始化，如设置CS:IP指向第一条指令**
4. **CPU一步步执行程序**

### 源程序

**汇编指令**：有对应机器码的指令，可以**被编译为机器码最终被CPU执行**

**伪指令**：没有对应的机器码，**不被CPU执行，由编译器来执行，根据伪指令来进行相关编译工作**

- **段：segment 和 ends是一对成对使用的伪指令，一个汇编程序一般由多个段组成**，这是在写可被编译器编译的汇编程序时，必须用到的伪指令
- **end：汇编程序的结束标记**
- **assume：将段寄存器与某一个具体的段相关联**

![](pic\84.png)

注意段结束后一定要返回

![](\pic\85.png)



## 基本概念

**<u>汇编语言可以看做机器语言的</u>**（汇编语言与机器语言是一对一的）

主要学习**汇编指令，伪指令，其他符号**

汇编代码-》编译器-》机器代码

![](pic\1.png)

**各种类型字节大小**

![](pic\3.png)

- **CPU：负责计算**

- **CU：负责同步时钟**

- **ALU：算数逻辑单元**

![](pic\4.png)

> **寄存器之所以分高位低位是由历史原因，从单片机，32位发展到现在，寄存器的位数也随之增加**

![](pic\5.png)

> - **.data：数据部分**
>- **.code：代码部分**
> - **main：入口点**
>
> - **；是注释**

![](pic\6.png)

**伪指令：是针对汇编器的命令，不属于指令集**

内存中二进制信息的实际意义取决于当前所在的语境之中

![](pic\71.png)

## 存储器

磁盘上的数据要被CPU使用，一定要先拷贝到内存中

CPU通过**总线**（一根根导线的集合）与其他芯片链接，包括**地址总线，数据总线，控制总线**

- **地址总线**：CPU通过地址总线来指定存储单元，**<u>地址总线能传多少信息，CPU就能操作多少存储单元</u>**，**N根地址总线，CPU最多能寻找2^N个内存单元**

- **控制总线**：CPU对外界的控制，比如要执行什么样的操作，宽度越大，CPU控制信息能力越强

- **数据总线**：CPU与内存之间进行数据传输的途径，**<u>数据总线的宽度决定数据传送速度</u>**![](pic\74.png)

  ![75](pic\75.png)

例：

![](pic\72.png)

![73](pic\73.png)

### 总结

三种总线的宽度决定了**CPU不同方面的性能**

![](pic\76.png)

## 内存地址空间

**概念**

RAM（random access memory）即随机存储内存，这种存储器在断电时将丢失其存储内容，故主要用于存储短时间使用的程序。ROM（Read-Only Memory）即只读内存，是一种只能读出事先所存数据的固态半导体存储器。

- **RAM：内存**
- **ROM：硬盘**

![](pic\77.png)

![](pic\78.png)

![](pic\79.png)

最终运行程序的是CPU，对CPU来讲系统中***所有存储单元都处于一个统一的逻辑存储器***中。

## Label

占位符的作用，约等于编程语言中的变量名，如果是代码的label后面会加：

![](pic\7.png)

## Comment

写注释，！开始！结束

![8](pic\8.png)

## 操作

![](pic\9.png)

## 数据定义

![](pic\10.png)

## 空格与换行

![](pic\11.png)

电脑RAM和ROM的区别是什么？

实际上这两个是都是内存的组成部分，**RAM是临时存放数据用的，关机后啥也没有**了，而**ROM则是存放有固定数据，且删不掉也无法覆盖其他数据**

**电脑RAM和ROM的区别和作用介绍：**

　　电脑中调用的数据，就需要从硬盘读出，发给内存（RAM和ROM），然后内存再发给CPU，也可以理解成是内存和CPU之间的缓存，因为CPU中的ALU（虚拟寄存器）速度要比硬盘速度快的多。所以需要内存用来给CPU和硬盘之间进行沟通。当然光盘/软盘等所有外存贮器都是用内存来作桥梁的。

![](pic\12.png)

![](pic\13.png)

## 寄存器与数据存储

8086CPU一共有***14个寄存器***

所有的寄存器都是16位，可以存放两个字节

***通用寄存器：为了兼容上一代的8位寄存器，可以分为两个独立使用***

![](pic\14.png)

![](pic\15.png)

**<u>8086是16位cpu，字长就为16bit，存储的最大数据是2^16-1</u>**

## 8086的寻址问题

![](pic\16.png)

### 解决方案

**<u>用两个16位的地址（段地址和 偏移地址）合成一个20位的物理地址</u>**

![](pic\17.png)

段地址和偏移地址

![](pic\18.png)

## 简单汇编指令

![](pic\80.png)

## CS,IP和代码段

CS,IP是两个关键寄存器

CS：代码段寄存器

IP：指令指针寄存器

![](pic\19.png)

执行完一个指令后，IP会增加到下一个指令

![](pic\20.png)

## jmp指令

转移指令：可以同时修改CS,IP也可以仅修改IP

用指令中的段地址改变CS，偏移地址改变IP

![](pic\21.png)

## 	DS和[address]

DS寄存器：段寄存器，存放段地址，偏移地址用[]的形式给出

![](pic\22.png)

## mov指令

![](pic\23.png)

## add和sub指令

![](pic\24.png)

![25](pic\25.png)

## push和pop指令

- **CS:IP：代码段**
- **SS:IP：栈**

![](pic\82.png)

![](pic\26.png)

栈的段寄存器和偏移寄存器

![](pic\27.png)

栈的操作

![](pic\28.png)

![](pic\29.png)

![](pic\81.png)

## 伪指令

![](pic\30.png)

## []和()

[]：一个内存单元

()：表示一个内存单元或者寄存器的内容

![](pic\31.png)

![32](pic\32.png)

## loop指令

**cx**：loop的条件码，也就是**存放循环次数**

![](pic\33.png)

## 段前缀

显式指明内存单元的段地址

![](pic\34.png)

## 标号

指示代码开始的地方

![](pic\35.png)

## 数据代码栈

面对大项目或者需要清晰结构时，应该**<u>把数据段，代码段，栈段分开声明</u>**

## 处理字符问题

**大写字符和小写字符的ascii码差20H**

![](pic\36.png)

大小写转换

**<u>大小写的ascii码只有第6位有差别（小写的是1，大写的是0）</u>**

![](pic\37.png)

> 小写转大写用and，大写转小写用or

例子：

![](pic\38.png)

## [bx + idata]

为高级语言的数组提供了便利

![](pic\39.png)

应用：

![](pic\40.png)

## SI和DI

SI和DI是和X功能相近的寄存器，**<u>经常用于对地址的操作</u>**

SI：源地址寄存器

DI：目标地址寄存器

> 唯一区别就是SI和DI不能分为两个8位寄存器

![](pic\41.png) 

其他方式指定地址

![](pic\42.png)

## 寻址方式总结

![](pic\43.png)

**<u>双重循环时需要注意先保存外层循环的cx，因为cx是公共的</u>**

![](pic\44.png)

更好的两种方法

![](pic\45.png)

## 内存寻址寄存器

只有BX,BP,SI,DI可以用[]对内存单元寻址

**指定访问内存单元是什么数据类型有时是必要的**

![](pic\47.png)

## div指令

![](pic\48.png)

示例：

![](pic\49.png)

示例

![](pic\50.png)

## dup指令

与数据定义伪指令配合使用，用来对数据进行重复

## 转移指令

![](pic\51.png)

## offset

**用来取得标号的偏移地址**

## jmp指令

可以只修改IP，也可以呃同时修改CS和IP

 两种段内短转移

![](pic\53.png)

远转移

![](pic\54.png)

转移地址在寄存器

![](pic\55.png)

转移地址在内存的jmp指令

![](pic\56.png)

![57](pic\57.png)

##  jcxz指令

功能：cx等于0时跳转到标号处执行

![](pic\58.png)

## call和ret指令

用于模块化程序设计

call：调用子程序

ret：返回

![](pic\59.png)

call指令

![](pic\60.png)

ret指令

![](pic\61.png)

应用

![](pic\62.png)

预处理器-》修改后的源代码-》编译器后变成目标汇编语言程序-》汇编器后变成重定位代码-》链接后变成目标可执行文件


