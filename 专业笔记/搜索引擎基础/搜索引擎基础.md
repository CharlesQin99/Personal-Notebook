# 搜索引擎基础

# Lesson1

![](PIC\0.png)

**范内瓦布什**

信息技术发展史中核心人物，**DARPA创立者，曼哈顿计划**核心人物

![](PIC\1.png)

![](PIC\2.png)

## 信息检索概念

Calvin Mooers (1919-1994)

1950年提出**<u>”信息检索”</u>**概念：

> 协助信息的潜在用户将信息需求
>
> 转换为一张文献来源信息列表，
>
> 而这些文献包含有对其有用的信息

Mooers’ law (different from Moore’s law)

> 一个信息检索系统如果对用户来说**使用难度过大的话，**
>
> **用户就会倾向于不使用该系统**
>
> **<u>*信息的使用与获得信息的容易程度成正比*</u>**

## 互联网

![](PIC\3.png)

![](PIC\4.png)

**互联网和万维网**的关系：

1. 互联网是线路、协议以及通过TCP/IP协议实现数据电子传输的硬件和软件的集合体。Internet**提供的<u>主要服务</u>有万维网(WWW)、文件传输（FTP)、电子邮件E-mail、远程登录（Telnet）**等。　
2. **<u>*万维网则存在于互联网之上*</u>**。它是**无数个网络站点和网页的集合，构成了因特网主要的部分**。它实际上是多媒体的集合，是由超链接连接而成的。我们通常通过网络浏览器上网观看的，就是万维网的内容。万维网由浏览器浏览连超文本页面组成，这些超文本页面是通过TCP/IP协议从网络上获取的。**网页的开头部分总是http://或者https://，表明被浏览器的信息是超文本，是利用超文本传输协议来传输的**。所以，如果把互联网看成是基础，那么万维网就可以被看成是对**<u>互联网的应用</u>**。
3. 万维网（World Wide Web）是作为欧洲核子研究组织的一个项目发展起来的，在那里 Tim Berners-Lee 开发出万维网的雏形。Tim Berners-Lee- 万维网的发明人和万维网联盟的主任。万维网是信息时代发展的核心，也是数十亿人在互联网上**进行交互的主要工具，但它并不等同于互联网，只是互联网提供的服务之一**。

![](PIC\5.png)

![](PIC\6.png)

> **Google这个名字从何而来，又代表了什么意义呢？** 
>
> Google是斯坦福大学学生肖恩·安德森(Sean Anderson)把谷歌搜索引擎和谷歌的名字带给谷歌创始人拉里·佩奇(Larry Page)。  当时，安德森和佩奇坐在办公室，试图想出一个很好的名字。  **一个能够和海量数据索引有关的名字**。  安德森说到了**<u>*“googol”一词，指的是10的100次幂*</u>**，写出的形式为数字1后跟100个零，可用来**代表在互联网上可以获得的海量的资源**。  当时安德森正坐在电脑前面，就在互联网域名注册数据库里面搜索了一下，看看这个新想出来的名字是有没有被注册和使用。  但是，**安德森犯了一个拼写错误， 他在搜索中把这个词打成了“google .com”**，他发现这个域名可以使用。于是就用了google.com这个域名。  当然，也有另外一种说法，“googol.com”被注册为域名是 1995 年 4 月 13 日的事情，而“google.com”到 1997 年 9 月 15 日才注册。因此很可能是由于 Googol 已经被占用，Larry 和 Sergey 才不得已采用了 Google。

**本节小结**

![](PIC\7.png)

# Lesson2

## 搜索引擎体系结构

![](PIC\8.png)

### 数据抓取子系统

性能要求：

- **全面性**
- **时效性**
- **高效性**

![](PIC\9.png)

![](PIC\10.png)

### 内容索引子系统

![](PIC\11.png)

主要功能：

- 倒排索引构建![](PIC\12.png)
- 正排索引构建![](PIC\13.png)
- 构建词项列表![](PIC\14.png)
- 提供稳定高效的索引查询服务![](PIC\15.png)

### 内容检索子系统

![](PIC\16.png)

主要功能：

- **网页与查询的内容相似度计算**
- **搜索结果排序**
- **两阶段检索框架**

性能要求：

- 准确理解用户信息需求
- 提供满足需求的搜索结果

### 链接结构分析子系统

![](PIC\17.png)

主要功能：

- **网络资源质量评估**![](PIC\18.png)
- **扩充文档描述内容**![](PIC\19.png)

性能要求：

**高效率进行网页质量估计**

## 搜索引擎体系结构设计理念

![](PIC\20.png)

**<u>可扩展性</u>**的设计理念：

![21](PIC\21.png)

# Lesson3

## 搜索引擎性能评价

搜索引擎性能评价的目的：

![](PIC\22.png)

### 性能评价流程

1. **搜索引擎性能评价的<u>关注对象</u>**![](PIC\23.png)
2. 搜索引擎性能评价的**<u>*Cranfield评价*</u>**，评价流程：![](PIC\24.png)

#### 语料库采集

![](PIC\25.png)

#### 查询样例集合构建

#### ![](PIC\26.png)

![](PIC\27.png)

![28](PIC\28.png)

##### 用户信息需求分布

![](PIC\29.png)

###### 导航类

![](PIC\30.png)

###### 信息类

![](PIC\31.png)

###### 事务类

![](PIC\32.png)

###### 总结

![](PIC\33.png)

![34](PIC\34.png)

### 结果相关性标注

需要注意：**<u>相对相关性和绝对相关性（客观与主观的区别）</u>**

![](PIC\35.png)

**标准：**

![](PIC\36.png)

![37](PIC\37.png) 

![](PIC\38.png)

### 评价指标

**准确率（Precision）**：找到的**是否准确**

**召回率（Recall）**：是否有**找全面**

![](PIC\39.png)

例：

![](PIC\40.png)

结果序列中的计算

![](PIC\41.png)

![42](PIC\42.png)

**综合考虑准确率和召回率的指标**

#### 平均准确率

**<u>平均准确率</u>** AP 计算公式：

![](PIC\43.png)

![](PIC\44.png)

#### 首位相关结果倒数

![45](PIC\45.png)

#### 前N位准确率

![46](PIC\46.png)

#### 前N位成功率

![47](PIC\47.png)

#### 其他

![](PIC\48.png)

## 总结

![](PIC\49.png)

![](PIC\50.png)

# Lesson4

## 数据抓取子系统

常用性能指标

![](PIC\51.png)

![](PIC\52.png)

### 运行原理与基本架构

![](PIC\53.png)

![](PIC\54.png)

### 万维网链接结构特性

万维网链接结构图的顶点规模很庞大，**站点级别：443万个，网页估计：3350亿个**

**边规模约为顶点规模的几到几十倍**

**连通性**

![](PIC\55.png)

![](PIC\56.png)

![](PIC\57.png)

![](PIC\58.png)

### 网页数据获取方法

#### 基本原理

**网页资源的组织方式：HTML**

![](PIC\59.png)

#### 网页解析

**URL正规化 + 信息抽取**

![](PIC\60.png)

#### 性能提升

可以利用**异步抓取**

![](PIC\61.png)

![](PIC\62.png)

#### 抓取控制

![](PIC\63.png)

![64](PIC\64.png)

### 抓取调度策略设计

##### 种子站点选取

![](PIC\65.png)

![](PIC\66.png)

##### 累积式抓取

采用**<u>广度优先策略</u> 或 <u>深度优先搜索</u>**

![](PIC\68.png)

![](PIC\67.png)

##### 增量式抓取

**<u>抓取/更新优先级的确定</u>**

![](PIC\69.png)

### 数据质量检测

##### 质量检测与过滤

过滤掉**<u>空白页或垃圾网页</u>**

![](PIC\70.png)

![](PIC\71.png)

### 重复页面检测

#### I-Match算法

![](PIC\72.png)

#### Shingling算法

![](PIC\73.png)

#### Simhash算法

根据词项重要程度将文档转化为哈希值表示

![](PIC\74.png)

例：

![](PIC\75.png)

# Lesson5

## 内容索引子系统

主要功能：

- 建立倒排索引
- 建立正排索引
- 提供索引查询服务

**词项（Term）**：索引子系统处理的**最小语义单位**

![](PIC\76.png)

### 词项列表构建

词项的作用：

- **作为语义的最小单位出现**
- **作为倒排索引的索引项出现**

#### 英文词项处理

- **大小写统一化**、命名实体识别
- **<u>去除停用词</u>**
- 取词干
- 合并索引项，**减少索引空间浪费**

![](PIC\77.png)

![](PIC\78.png)

**预处理**的重要性：

![](PIC\79.png)

#### 中文词项处理

- **编码处理**：全/半角符号处理
- **去除停用词**：的，是，和，在，注意停用词的**歧义性**

![](PIC\80.png)

不同的搜索引擎处理停用词的策略不同

##### 分词方法

- 基于**词典**
- 基于**理解**
- 基于**统计**

![](PIC\81.png)

![](PIC\82.png)

**分词面临的技术挑战**

- **交集型歧义**：![](PIC\83.png)
- **覆盖型歧义**：![](PIC\84.png)

例如**搜狗输入法**采用**细胞词库**方法帮助构建词典

核心思想：将用户**拼音输入法低调加入搜索引擎**，只有文件名索引的桌面搜索占用空间也小

![](PIC\85.png)

![](PIC\86.png)

#### 词项列表的规模

![](PIC\87.png)

#### Zipf's Law

核心：数量较少的**高频词占大部分语料内容**，但**低频词占有词项列表**的主要组成部分**（<u>浪费存储空间和编码空间</u>）**

![](PIC\91.png)

![](PIC\88.png)

![](PIC\89.png)

![](PIC\90.png)

### 索引数据结构

![](PIC\92.png)

**词项出现信息记录**

需要记录基本信息：**位置、字体、类别**

![](PIC\93.png)

![](PIC\94.png)

#### 正排索引与倒排索引

**正排索引**

![](PIC\95.png)

**倒排索引**

![](PIC\96.png)

总结：

正向索引：**文档列表 ——> 单词的关键字**，**<u>文档核心</u>**

倒排索引：**单词的关键字 ——> 文档列表**，**<u>单词核心</u>**

假设只存在**正向索引（forward index），那么就需要扫描索引库中的所有文档**，找出所有包含关键词“华为手机”的文档，再根据打分模型进行打分，排出名次后呈现给用户。因为互联网上收录在搜索引擎中的文档的数目是个天文数字，**<u>这样的索引结构根本无法满足实时返回排名结果的要求</u>**。所以需要将**正向索引重构为倒排索引**

![](PIC\107.png)

例：

正排索引 ——> 倒排索引

![](PIC\108.png)

![109](PIC\109.png)

更多信息的倒排索引：

- 主要信息：**文档ID ,词频，位置**

![](PIC\110.png)

**倒排索引结构 = 单词词典＋倒排列表**

<u>**单词词典** = **B+ 树 + 哈希链表**</u>

![](PIC\112.png)

> **解析文档**：在建立索引的过程中，词典结构也会相应地被构建出来。比如在解析一个新文档的时候，对于某个在文档中出现的单词T，首先**利用哈希函数获得其哈希值，之后根据哈希值对应的哈希表项读取其中保存的指针，就找到了对应的冲突链表**。如果冲突链表里已经存在这个单词，说明单词在之前解析的文档里已经出现过。如果在冲突链表里没有发现这个单词，说明该单词是首次碰到，则将其加入冲突链表里。通过这种方式，当文档集合内所有文档解析完毕时，相应的词典结构也就建立起来了。
>
> **响应查询**：在响应用户查询请求时，其过程与建立词典类似，不同点在于即使词典里没出现过某个单词，也不会添加到词典内。以上图为例，假设用户输入的查询请求为单词3，对这个单词进行哈希，定位到哈希表内的2号槽，从其保留的指针可以获得冲突链表，依次将单词3和冲突链表内的单词比较，发现单词3在冲突链表内，于是找到这个单词，之后可以读出这个单词对应的倒排列表来进行后续的工作，如果没有找到这个单词，说明文档集合内没有任何文档包含单词，则搜索结果为空。

![113](PIC\113.png)

- **单词词典（Term Dictionary）**，**记录<u>*所有文档的单词以及单词到倒排列表*</u>的关联关系**。在前面的例子中，单词的量并不是很多，但是在实际生产中，单词量会非常大，所以实际会**采用 B+ 树 + 哈希链表法**去存储单词的词典，以满足**<u>高性能的插入与查询</u>**。
- **倒排列表（Posting List）**，它记录了**单词对应文档的结合**，倒排列表是由**倒排索引项（Posting） 组成**，倒排索引项包含：

> - 文档 ID：用于获取原始信息
> - 词频（TF，Term Frequency）：该单词在文档中出现的次数，用于相关性评分
> - 位置（Position）：单词在文档中分词的位置，用于语句搜索（Phrase Query）
> - 偏移（Offset）：记录单词的开始结束位置，实现高亮显示（比如用 GitHub 搜索的时候，搜索的关键词会高亮显示）

![](PIC\111.png)

**并行存储结构**

![](PIC\97.png)

![](PIC\98.png)

**按词项划分**

![](PIC\99.png)

**按文档划分**

![](PIC\100.png)

#### 索引建立过程

1. **文档预处理**
2. **构建正排索引**
3. **构建倒排索引**
4. **性能优化**

![](PIC\101.png)

![102](PIC\102.png)

![103](PIC\103.png)

![104](PIC\104.png)

#### 索引查询过程

- 用户输入：查询词
- 系统输出：包含以上查询词的文档列表

![](PIC\105.png)

整个查询过程**用缓存服务器进行优化**和**关键位置倒排索引**

![](PIC\106.png)

## Lesson6

**链接结构分析子系统**

![](PIC\114.png)

**主要功能**：

- 链接分析算法实现页面**质量评估**
- 链接机构分析**扩充文档**描述内容

### HITS算法

Hyperlink-Induced Topic Search **基于超链接推演的主题搜索**

HITS对网页质量的定义：

- **内容权威度**
- **链接权威度**

![](PIC\115.png)

![](PIC\116.png)

![](PIC\117.png)

**实际应用**

![](PIC\118.png)

### PageRank算法

[PageRank:随机游走模型（一） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/144042830)

[(230条消息) PageRank算法 -- 图算法_chuanauc的博客-CSDN博客](https://blog.csdn.net/qq_41764621/article/details/124065547)

（1）**数量假设**：在网页模型图中，一个网页接收到的其他网页指向的入链（in-links）越多，说明该网页越重要。

（2）**质量假设**：当一个质量高的网页指向（out-links）一个网页，说明这个被指向的网页质量也高。

**阻尼系数 d = 1-α**

![](PIC\134.png)

![](PIC\138.png)

![](PIC\119.png)

**浏览起始点和页内超链接随机**

![](PIC\120.png)

![](PIC\121.png)

![](PIC\122.png)

![](PIC\123.png)

例：

![](PIC\124.png)

**特殊情况**

网页无出链接的时候将**PR均分给G中所有网页**

网页**有可能出度 =** 0，即无出边节点，做出改进：

![](PIC\135.png)

![](PIC\125.png)

![](PIC\126.png)

#### **Google简单示意图**

![](PIC\137.png)

#### 算法实现

![](PIC\127.png)

![](PIC\128.png)

![](PIC\129.png)

总结：

- **决定结果排序的重要因素之一**
- **辅助网页抓取系统，内容索引系统工作**

![](PIC\130.png)

#### 优缺点

![](PIC\136.png)

### 链接结构数据清理

原因：

- **功能性超链接：广告，导航，注册信息等**
- **恶意添加的垃圾链接**

![](PIC\131.png)

![](PIC\133.png)

![](PIC\132.png)